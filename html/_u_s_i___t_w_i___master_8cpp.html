<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Adafruit TinyWireM Library: USI_TWI_Master.cpp File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Adafruit TinyWireM Library
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">USI_TWI_Master.cpp File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &quot;<a class="el" href="_u_s_i___t_w_i___master_8h_source.html">USI_TWI_Master.h</a>&quot;</code><br />
<code>#include &lt;avr/interrupt.h&gt;</code><br />
<code>#include &lt;avr/io.h&gt;</code><br />
<code>#include &lt;util/delay.h&gt;</code><br />
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">union &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="union_u_s_i___t_w_i__state.html">USI_TWI_state</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Stores the state of the <a class="el" href="class_u_s_i___t_w_i.html" title="class USI_TWI : public Stream ">USI_TWI</a>.  <a href="union_u_s_i___t_w_i__state.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a0d0ca11e5a3dd62f78265ee2e4117bf4"><td class="memItemLeft" align="right" valign="top">unsigned char&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_u_s_i___t_w_i___master_8cpp.html#a0d0ca11e5a3dd62f78265ee2e4117bf4">USI_TWI_Start_Transceiver_With_Data</a> (unsigned char *, unsigned char)</td></tr>
<tr class="memdesc:a0d0ca11e5a3dd62f78265ee2e4117bf4"><td class="mdescLeft">&#160;</td><td class="mdescRight">USI Transmit and receive function.  <a href="#a0d0ca11e5a3dd62f78265ee2e4117bf4">More...</a><br /></td></tr>
<tr class="separator:a0d0ca11e5a3dd62f78265ee2e4117bf4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aecd07eae8d5d2b056b974f06fda13ea9"><td class="memItemLeft" align="right" valign="top">unsigned char&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_u_s_i___t_w_i___master_8cpp.html#aecd07eae8d5d2b056b974f06fda13ea9">USI_TWI_Master_Transfer</a> (unsigned char temp)</td></tr>
<tr class="memdesc:aecd07eae8d5d2b056b974f06fda13ea9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Core function for shifting data in and out from the USI. Data to be sent has to be placed into the USIDR prior to calling this function. Data read, will be return'ed from the function.  <a href="#aecd07eae8d5d2b056b974f06fda13ea9">More...</a><br /></td></tr>
<tr class="separator:aecd07eae8d5d2b056b974f06fda13ea9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5157a4f51b01101e68f865b409c24ff3"><td class="memItemLeft" align="right" valign="top">unsigned char&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_u_s_i___t_w_i___master_8cpp.html#a5157a4f51b01101e68f865b409c24ff3">USI_TWI_Master_Start</a> (void)</td></tr>
<tr class="memdesc:a5157a4f51b01101e68f865b409c24ff3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Function for generating a TWI Start Condition.  <a href="#a5157a4f51b01101e68f865b409c24ff3">More...</a><br /></td></tr>
<tr class="separator:a5157a4f51b01101e68f865b409c24ff3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0302cb7100044631f458a4b1e7f1e93f"><td class="memItemLeft" align="right" valign="top"><a id="a0302cb7100044631f458a4b1e7f1e93f"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_u_s_i___t_w_i___master_8cpp.html#a0302cb7100044631f458a4b1e7f1e93f">USI_TWI_Master_Initialise</a> (void)</td></tr>
<tr class="memdesc:a0302cb7100044631f458a4b1e7f1e93f"><td class="mdescLeft">&#160;</td><td class="mdescRight">USI TWI single master initialization function. <br /></td></tr>
<tr class="separator:a0302cb7100044631f458a4b1e7f1e93f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0be51ae7c624eae9627dc1a3dd22d0ec"><td class="memItemLeft" align="right" valign="top">unsigned char&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_u_s_i___t_w_i___master_8cpp.html#a0be51ae7c624eae9627dc1a3dd22d0ec">USI_TWI_Get_State_Info</a> (void)</td></tr>
<tr class="memdesc:a0be51ae7c624eae9627dc1a3dd22d0ec"><td class="mdescLeft">&#160;</td><td class="mdescRight">Use this function to get hold of the error message from the last transmission.  <a href="#a0be51ae7c624eae9627dc1a3dd22d0ec">More...</a><br /></td></tr>
<tr class="separator:a0be51ae7c624eae9627dc1a3dd22d0ec"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a54ba90e00fb568a964fd2609aaa77ab0"><td class="memItemLeft" align="right" valign="top">unsigned char&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_u_s_i___t_w_i___master_8cpp.html#a54ba90e00fb568a964fd2609aaa77ab0">USI_TWI_Start_Random_Read</a> (unsigned char *msg, unsigned char msgSize)</td></tr>
<tr class="memdesc:a54ba90e00fb568a964fd2609aaa77ab0"><td class="mdescLeft">&#160;</td><td class="mdescRight">USI Random (memory) Read function. This function sets up for call to USI_TWI_Start_Transceiver_With_Data which does the work. Doesn't matter if read/write bit is set or cleared, it'll be set correctly in this function.  <a href="#a54ba90e00fb568a964fd2609aaa77ab0">More...</a><br /></td></tr>
<tr class="separator:a54ba90e00fb568a964fd2609aaa77ab0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a73c2f8916c354a1959d038e4df633eef"><td class="memItemLeft" align="right" valign="top">unsigned char&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_u_s_i___t_w_i___master_8cpp.html#a73c2f8916c354a1959d038e4df633eef">USI_TWI_Start_Read_Write</a> (unsigned char *msg, unsigned char msgSize)</td></tr>
<tr class="memdesc:a73c2f8916c354a1959d038e4df633eef"><td class="mdescLeft">&#160;</td><td class="mdescRight">USI Normal Read / Write Function Transmit and receive function. LSB of first byte in buffer indicates if a read or write cycles is performed. If set a read operation is performed.  <a href="#a73c2f8916c354a1959d038e4df633eef">More...</a><br /></td></tr>
<tr class="separator:a73c2f8916c354a1959d038e4df633eef"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0204d57171d7af611a21ce0b6a4d1c51"><td class="memItemLeft" align="right" valign="top">unsigned char&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_u_s_i___t_w_i___master_8cpp.html#a0204d57171d7af611a21ce0b6a4d1c51">USI_TWI_Master_Stop</a> (void)</td></tr>
<tr class="memdesc:a0204d57171d7af611a21ce0b6a4d1c51"><td class="mdescLeft">&#160;</td><td class="mdescRight">Function for generating a TWI Stop Condition. Used to release the TWI bus.  <a href="#a0204d57171d7af611a21ce0b6a4d1c51">More...</a><br /></td></tr>
<tr class="separator:a0204d57171d7af611a21ce0b6a4d1c51"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a9b99ba9900232c44503409812e1ed1da"><td class="memItemLeft" align="right" valign="top"><a id="a9b99ba9900232c44503409812e1ed1da"></a>
union <a class="el" href="union_u_s_i___t_w_i__state.html">USI_TWI_state</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_u_s_i___t_w_i___master_8cpp.html#a9b99ba9900232c44503409812e1ed1da">USI_TWI_state</a></td></tr>
<tr class="memdesc:a9b99ba9900232c44503409812e1ed1da"><td class="mdescLeft">&#160;</td><td class="mdescRight"><a class="el" href="union_u_s_i___t_w_i__state.html" title="Stores the state of the USI_TWI. ">USI_TWI_state</a> The state of the <a class="el" href="class_u_s_i___t_w_i.html" title="class USI_TWI : public Stream ">USI_TWI</a>. <br /></td></tr>
<tr class="separator:a9b99ba9900232c44503409812e1ed1da"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function Documentation</h2>
<a id="a0d0ca11e5a3dd62f78265ee2e4117bf4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0d0ca11e5a3dd62f78265ee2e4117bf4">&#9670;&nbsp;</a></span>USI_TWI_Start_Transceiver_With_Data()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned char USI_TWI_Start_Transceiver_With_Data </td>
          <td>(</td>
          <td class="paramtype">unsigned char *&#160;</td>
          <td class="paramname"><em>msg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned char&#160;</td>
          <td class="paramname"><em>msgSize</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>USI Transmit and receive function. </p>
<p>USI Transmit and receive function. LSB of first byte in buffer indicates if a read or write cycles is performed. If set a read operation is performed.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">msg</td><td>Pointer to the location of the msg buffer </td></tr>
    <tr><td class="paramname">msgSize</td><td>How much data to send from the buffer </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Returns true if transmission was successful</dd></dl>
<p>Function generates (Repeated) Start Condition, sends address and R/W, Reads/Writes Data, and verifies/sends ACK.</p>
<p>This function also handles Random Read function if the memReadMode bit is set. In that case, the function will: The address in memory will be the second byte and is written <em>without</em> sending a STOP. Then the Read bit is set (lsb of first byte), the byte count is adjusted (if needed), and the function function starts over by sending the slave address again and reading the data.</p>
<p>Success or error code is returned. Error codes are defined in <a class="el" href="_u_s_i___t_w_i___master_8h.html">USI_TWI_Master.h</a> </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">msg</td><td>Pointer to the location of the msg buffer </td></tr>
    <tr><td class="paramname">msgSize</td><td>How much data to send from the buffer </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="aecd07eae8d5d2b056b974f06fda13ea9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aecd07eae8d5d2b056b974f06fda13ea9">&#9670;&nbsp;</a></span>USI_TWI_Master_Transfer()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned char USI_TWI_Master_Transfer </td>
          <td>(</td>
          <td class="paramtype">unsigned char&#160;</td>
          <td class="paramname"><em>temp</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Core function for shifting data in and out from the USI. Data to be sent has to be placed into the USIDR prior to calling this function. Data read, will be return'ed from the function. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">temp</td><td>Temperature to set the USISR </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Returns the temp read from the device </dd></dl>

</div>
</div>
<a id="a5157a4f51b01101e68f865b409c24ff3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5157a4f51b01101e68f865b409c24ff3">&#9670;&nbsp;</a></span>USI_TWI_Master_Start()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned char USI_TWI_Master_Start </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Function for generating a TWI Start Condition. </p>
<dl class="section return"><dt>Returns</dt><dd>Returns true if the signal can be verified, otherwise returns false </dd></dl>

</div>
</div>
<a id="a0be51ae7c624eae9627dc1a3dd22d0ec"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0be51ae7c624eae9627dc1a3dd22d0ec">&#9670;&nbsp;</a></span>USI_TWI_Get_State_Info()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned char USI_TWI_Get_State_Info </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Use this function to get hold of the error message from the last transmission. </p>
<dl class="section return"><dt>Returns</dt><dd>Returns error state </dd></dl>

</div>
</div>
<a id="a54ba90e00fb568a964fd2609aaa77ab0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a54ba90e00fb568a964fd2609aaa77ab0">&#9670;&nbsp;</a></span>USI_TWI_Start_Random_Read()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned char USI_TWI_Start_Random_Read </td>
          <td>(</td>
          <td class="paramtype">unsigned char *&#160;</td>
          <td class="paramname"><em>msg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned char&#160;</td>
          <td class="paramname"><em>msgSize</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>USI Random (memory) Read function. This function sets up for call to USI_TWI_Start_Transceiver_With_Data which does the work. Doesn't matter if read/write bit is set or cleared, it'll be set correctly in this function. </p>
<p>The msgSize is passed to USI_TWI_Start_Transceiver_With_Data.</p>
<p>Success or error code is returned. Error codes are defined in <a class="el" href="_u_s_i___t_w_i___master_8h.html">USI_TWI_Master.h</a> </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">msg</td><td>Pointer to the buffer that contains the messages to be read </td></tr>
    <tr><td class="paramname">msgSize</td><td>How much to read from the buffer </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Returns the message read </dd></dl>

</div>
</div>
<a id="a73c2f8916c354a1959d038e4df633eef"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a73c2f8916c354a1959d038e4df633eef">&#9670;&nbsp;</a></span>USI_TWI_Start_Read_Write()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned char USI_TWI_Start_Read_Write </td>
          <td>(</td>
          <td class="paramtype">unsigned char *&#160;</td>
          <td class="paramname"><em>msg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned char&#160;</td>
          <td class="paramname"><em>msgSize</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>USI Normal Read / Write Function Transmit and receive function. LSB of first byte in buffer indicates if a read or write cycles is performed. If set a read operation is performed. </p>
<p>Function generates (Repeated) Start Condition, sends address and R/W, Reads/Writes Data, and verifies/sends ACK.</p>
<p>Success or error code is returned. Error codes are defined in <a class="el" href="_u_s_i___t_w_i___master_8h.html">USI_TWI_Master.h</a> </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">msg</td><td>Pointer to the buffer that has the messages </td></tr>
    <tr><td class="paramname">msgSize</td><td>The size of the message </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Returns the data read </dd></dl>

</div>
</div>
<a id="a0204d57171d7af611a21ce0b6a4d1c51"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0204d57171d7af611a21ce0b6a4d1c51">&#9670;&nbsp;</a></span>USI_TWI_Master_Stop()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned char USI_TWI_Master_Stop </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Function for generating a TWI Stop Condition. Used to release the TWI bus. </p>
<dl class="section return"><dt>Returns</dt><dd>Returns true if it was successful </dd></dl>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
